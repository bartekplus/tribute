!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Tribute=e()}(this,(function(){"use strict";function t(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n}Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(t){if(null===this)throw TypeError('"this" is null or not defined');const e=Object(this),n=e.length>>>0;if("function"!=typeof t)throw TypeError("predicate must be a function");const i=arguments[1];let r=0;for(;r<n;){const n=e[r];if(t.call(i,n,r,e))return n;r++}},configurable:!0,writable:!0}),"undefined"!=typeof window&&"function"!=typeof window.CustomEvent&&(void 0!==window.Event&&(t.prototype=window.Event.prototype),window.CustomEvent=t);class e{constructor(t){this.tribute=t,this.tribute.events=this}static keys(){return["Tab","Enter","Escape","ArrowUp","ArrowDown"]}static modifiers(){return["CapsLock","Control","Fn","Hyper","Meta","OS","Super","Symbol","Win"]}bind(t){t.boundKeyDown=this.keydown.bind(t,this),t.boundKeyUpInput=this.tribute.debounce(this.input.bind(t,this),16),t.addEventListener("keydown",t.boundKeyDown,!0),t.addEventListener("keyup",t.boundKeyUpInput,!0),t.addEventListener("input",t.boundKeyUpInput,!0)}unbind(t){t.removeEventListener("keydown",t.boundKeyDown,!0),t.removeEventListener("keyup",t.boundKeyUpInput,!0),t.removeEventListener("input",t.boundKeyUpInput,!0),delete t.boundKeyDown,delete t.boundKeyUpInput}keydown(t,n){if(t.shouldDeactivate(n)&&t.tribute.hideMenu(),n instanceof KeyboardEvent){let t=!1;if(e.modifiers().forEach((e=>{n.getModifierState(e)&&(t=!0)})),t)return}t.tribute.isActive&&e.keys().forEach((e=>{e===n.code&&t.callbacks()[e](n,this)}))}input(t,e){e instanceof CustomEvent||t.keyup.call(this,t,e)}click(t,e){const n=t.tribute;if(n.menu&&n.menu.contains(e.target)){let t=e.target;for(e.preventDefault(),e.stopImmediatePropagation();"li"!==t.nodeName.toLowerCase();)if(t=t.parentNode,!t||t===n.menu)throw new Error("cannot find the <li> container for the click");n.selectItemAtIndex(t.getAttribute("data-index"),e)}else n.hideMenu()}keyup(t,n){if(n instanceof KeyboardEvent){if(n.key||n.key.length>1)return;let t=!1;if(e.modifiers().forEach((e=>{n.getModifierState(e)&&(t=!0)})),e.keys().forEach((e=>{e!==n.code||(t=!0)})),t)return}if(!t.updateSelection(this))return;if(!t.tribute.allowSpaces&&t.tribute.hasTrailingSpace)return t.tribute.hasTrailingSpace=!1,void t.callbacks().Space(n,this);const i=t.getKeyCode(n);if(!isNaN(i)){if(t.tribute.autocompleteMode)t.tribute.current.collection=t.tribute.collection[0];else{const e=t.tribute.triggers().find((t=>t.charCodeAt(0)===i));if(!e)return;const n=t.tribute.collection.find((t=>t.trigger===e));if(!n)return;if(n.menuShowMinLength>t.tribute.current.mentionText.length)return;t.tribute.current.collection=n}t.tribute.showMenuFor(this,!0)}}shouldDeactivate(t){let n=!1;return e.keys().forEach((e=>{e!==t.code||(n=!0)})),!n&&!!this.tribute.isActive}getKeyCode(t){const e=t.keyCode||t.which||t.code;return e||(this.tribute.current.mentionTriggerChar?this.tribute.current.mentionTriggerChar.charCodeAt(0):this.tribute.current.mentionText?this.tribute.current.mentionText.charCodeAt(this.tribute.current.mentionText.length-1):NaN)}updateSelection(t){this.tribute.current.element=t;const e=this.tribute.range.getTriggerInfo(!1,this.tribute.hasTrailingSpace,!0,this.tribute.allowSpaces,this.tribute.autocompleteMode);return!!e&&(this.tribute.current.mentionTriggerChar=e.mentionTriggerChar,this.tribute.current.mentionText=e.mentionText,this.tribute.current.mentionPosition=e.mentionPosition,this.tribute.current.fullText=e.fullText,!0)}callbacks(){return{Enter:(t,e)=>{this.tribute.isActive&&this.tribute.current.filteredItems&&(t.preventDefault(),t.stopImmediatePropagation(),this.tribute.selectItemAtIndex(this.tribute.menuSelected,t))},Escape:(t,e)=>{this.tribute.isActive&&(t.preventDefault(),t.stopImmediatePropagation(),this.tribute.hideMenu())},Tab:(t,e)=>{this.callbacks().Enter(t,e)},Space:(t,e)=>{this.tribute.isActive&&(this.tribute.spaceSelectsMatch?this.callbacks().Enter(t,e):this.tribute.allowSpaces||(t.stopImmediatePropagation(),setTimeout((()=>{this.tribute.hideMenu()}),0)))},ArrowUp:(t,e)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopImmediatePropagation();const e=this.tribute.current.filteredItems.length,n=this.tribute.menuSelected;e>n&&n>0?(this.tribute.menuSelected--,this.setActiveLi()):0===n&&(this.tribute.menuSelected=e-1,this.setActiveLi(),this.tribute.menu.scrollTop=this.tribute.menu.scrollHeight)}},ArrowDown:(t,e)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopImmediatePropagation();const e=this.tribute.current.filteredItems.length-1,n=this.tribute.menuSelected;e>n?(this.tribute.menuSelected++,this.setActiveLi()):e===n&&(this.tribute.menuSelected=0,this.setActiveLi(),this.tribute.menu.scrollTop=0)}},Delete:(t,e)=>{this.tribute.isActive&&this.tribute.current.mentionText.length<1?this.tribute.hideMenu():this.tribute.isActive&&this.tribute.showMenuFor(e)}}}setActiveLi(t){const e=this.tribute.menu.querySelectorAll("li"),n=e.length>>>0;t&&(this.tribute.menuSelected=parseInt(t));for(let t=0;t<n;t++){const n=e[t];if(t===this.tribute.menuSelected){n.classList.add(this.tribute.current.collection.selectClass);const t=n.getBoundingClientRect(),e=this.tribute.menu.getBoundingClientRect();if(t.bottom>e.bottom){const n=t.bottom-e.bottom;this.tribute.menu.scrollTop+=n}else if(t.top<e.top){const n=e.top-t.top;this.tribute.menu.scrollTop-=n}}else n.classList.remove(this.tribute.current.collection.selectClass)}}getFullHeight(t,e){const n=t.getBoundingClientRect().height;if(e){const e=t.currentStyle||window.getComputedStyle(t);return n+parseFloat(e.marginTop)+parseFloat(e.marginBottom)}return n}}class n{constructor(t){this.tribute=t,this.tribute.menuEvents=this,this.menu=this.tribute.menu}bind(t){this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.tribute.debounce((()=>{this.tribute.hideMenu()}),10,!1),this.windowResizeEvent=this.tribute.debounce((()=>{this.tribute.hideMenu()}),10,!1),this.windowBlurEvent=()=>{this.tribute.hideMenu()},this.tribute.range.getDocument().addEventListener("MSPointerDown",this.menuClickEvent,!1),this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),window.addEventListener("blur",this.windowBlurEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}unbind(t){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),this.tribute.range.getDocument().removeEventListener("MSPointerDown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}}class i{constructor(t){this.tribute=t,this.tribute.range=this}getDocument(){let t;return this.tribute.current.collection&&(t=this.tribute.current.collection.iframe),t?t.contentWindow.document:document}positionMenuAtCaret(t){const e=this.tribute.current;let n;this.tribute.positionMenu?(n=this.isContentEditable(e.element)?this.getContentEditableCaretPosition(e.mentionPosition+e.mentionText.length):this.getTextAreaOrInputUnderlinePosition(e.element,e.mentionPosition+e.mentionText.length),this.tribute.menu.style.top=`${n.top}px`,this.tribute.menu.style.left=`${n.left}px`,this.tribute.menu.style.right=`${n.right}px`,this.tribute.menu.style.bottom=`${n.bottom}px`,this.tribute.menu.style["max-heigh"]=`${n.maxHeight||500}px`,this.tribute.menu.style["max-width"]=`${n.maxWidth||300}px`,this.tribute.menu.style.position=`${n.position||"absolute"}`,this.tribute.menu.style.display="block","auto"===n.left&&(this.tribute.menu.style.left="auto"),"auto"===n.top&&(this.tribute.menu.style.top="auto"),t&&this.scrollIntoView()):this.tribute.menu.style.display="block"}get menuContainerIsBody(){return this.tribute.menuContainer===this.getDocument().body||!this.tribute.menuContainer}replaceTriggerText(t,e,n){const i=this.tribute.current,r={item:n,context:i,event:e,text:t},o=new CustomEvent("tribute-replaced");if(this.isContentEditable(i.element)){t+="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:"Â ",this.pasteHtml(t,i.mentionText.length+i.mentionTriggerChar.length)}else{const e=t!==t.trimEnd(),n=this.tribute.current.element,r="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";t=this.stripHtml(t),t+=r;const o=i.mentionPosition;let s=i.mentionPosition+i.mentionText.length+r.length+e;this.tribute.autocompleteMode||(s+=i.mentionTriggerChar.length-1),n.value=n.value.substring(0,o)+t+n.value.substring(s,n.value.length),n.selectionStart=o+t.length,n.selectionEnd=o+t.length}i.element.dispatchEvent(new CustomEvent("input",{bubbles:!0,detail:r})),i.element.dispatchEvent(o)}pasteHtml(t,e){const{sel:n}=this.getContentEditableSelectionStart(!0);if(n){let i=null;for(let t=0;t<e;t++)n.modify("extend","backward","character");i=n.getRangeAt(0),i.deleteContents();const r=this.getDocument().createElement("div");r.innerHTML=t;const o=this.getDocument().createDocumentFragment();let s,l;for(;s=r.firstChild;)l=o.appendChild(s);i.insertNode(o),l&&(i.setStart(l,l.length),i.setEnd(l,l.length),i.collapse(!0),n.removeAllRanges(),n.addRange(i),n.collapseToEnd())}}stripHtml(t){const e=this.getDocument().createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}getWindowSelection(){if(this.tribute.collection.iframe)return this.tribute.collection.iframe.contentWindow.getSelection();const t=this.tribute.current.element.getRootNode();return t.getSelection?t.getSelection():window.getSelection()}getContentEditableSelectionStart(t){const e=this.getWindowSelection();if(!e.isCollapsed)return{sel:null,range:null,direction:null};const n=e.anchorOffset<=e.focusOffset,i=e.getRangeAt(0),r=e.anchorNode,o=r.textContent,s=i.startOffset;let l=o.length>s?o[s]:null;if(null===l&&r.nextSibling&&r.nextSibling.textContent){const t=r.nextSibling.textContent;l=t.length?t[0]:null}const u=l&&l.match(this.tribute.autocompleteSeparator);return e.collapseToEnd(),l&&!u&&t&&e.modify("move","forward","word"),{sel:e,range:i,direction:n}}getWholeWordsUpToCharIndex(t,e){let n=0;const i=t.split(this.tribute.autocompleteSeparator).filter((function(t){return t.trim()})),r=t;for(let r=0,o=i.length;r<o;r++){const o=t.indexOf(i[r]);if(n+=o,t=t.slice(o),e>=n&&e<=n+i[r].length){e=n+i[r].length;break}}return r.substring(0,e)}getTextPrecedingCurrentSelection(){const t=this.tribute.current;let e=null;if(this.isContentEditable(t.element)){const{sel:t,range:n,direction:i}=this.getContentEditableSelectionStart(!0);if(t){const r=t.anchorNode.textContent,o=n.startOffset,s=r[Math.max(0,o-1)],l=s&&s!==s.trim();e=t.toString().trim();for(let n=0;n<this.tribute.numberOfWordsInContextText;n++){t.modify("extend","backward","word");const n=t.toString().trim();n.length>e.length&&n.endsWith(e)&&(e=n)}e+=l?" ":"",this.restoreSelection(t,n,i)}}else{const t=this.tribute.current.element;if(t){const n=t.selectionStart,i=t.selectionEnd;t.value&&n>=0&&n===i&&(e=t.value.substring(0),e=this.getWholeWordsUpToCharIndex(e,n))}}return e}getLastWordInText(t){const e=this.tribute.autocompleteSeparator?this.tribute.autocompleteSeparator:/\s+/,n=t.split(e);return n.length?n[n.length-1]:" "}getTriggerInfo(t,e,n,i,r){const o=this.getTextPrecedingCurrentSelection();if(null===o)return null;const s=this.getLastWordInText(o);if(r)return{mentionPosition:o.length-s.length,mentionText:s,fullText:o,mentionTriggerChar:""};if(null!=o){let r,s=-1;if(this.tribute.collection.forEach((t=>{const e=t.trigger,i=t.requireLeadingSpace?this.lastIndexWithLeadingSpace(o,e):o.lastIndexOf(e);i>s&&(s=i,r=e,n=t.requireLeadingSpace)})),s>=0&&(0===s||!n||/\s/.test(o.substring(s-1,s)))){let n=o.substring(s+r.length,o.length);r=o.substring(s,s+r.length);const l=n.substring(0,1),u=n.length>0&&(" "===l||"Â "===l);e&&(n=n.trim());const c=i?/[^\S ]/g:/[\xA0\s]/g;if(this.tribute.hasTrailingSpace=c.test(n),!u&&(t||!c.test(n)))return{mentionPosition:s,mentionText:n,mentionTriggerChar:r,fullText:o}}}}lastIndexWithLeadingSpace(t,e){const n=t.split("").reverse().join("");let i=-1;for(let r=0,o=t.length;r<o;r++){const o=r===t.length-1,s=/\s/.test(n[r+1]);let l=!0;for(let t=e.length-1;t>=0;t--)if(e[t]!==n[r-t]){l=!1;break}if(l&&(o||s)){i=t.length-1-r;break}}return i}isContentEditable(t){return"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName}isMenuOffScreen(t,e){const n=window.innerWidth,i=window.innerHeight,r=this.getDocument().documentElement,o=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),s=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),l="number"==typeof t.top?t.top:t.bottom-e.height,u="number"==typeof t.right?t.right:t.left+e.width,c="number"==typeof t.bottom?t.bottom:t.top+e.height,a="number"==typeof t.left?t.left:t.right-e.width;return{top:l<Math.floor(s),right:u>Math.ceil(o+n),bottom:c>Math.ceil(s+i),left:a<Math.floor(o)}}getMenuDimensions(){const t={width:null,height:null};return this.tribute.menu.style.top="0px",this.tribute.menu.style.left="0px",this.tribute.menu.style.right=null,this.tribute.menu.style.bottom=null,this.tribute.menu.style.position="fixed",this.tribute.menu.style.visibility="hidden",this.tribute.menu.style.display="block",t.width=this.tribute.menu.offsetWidth,t.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.display="none",this.tribute.menu.style.visibility="visible",t}getTextAreaOrInputUnderlinePosition(t,e,n){const i=this.getDocument().createElement("div");i.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(i);const r=i.style,o=window.getComputedStyle?getComputedStyle(t):t.currentStyle;r.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((t=>{r[t]=o[t]}));const s=this.getDocument().createElement("span");s.textContent=t.value.substring(0,e),i.appendChild(s),"INPUT"===t.nodeName&&(i.textContent=i.textContent.replace(/\s/g,"Â "));const l=this.getDocument().createElement("span");i.appendChild(l);const u=this.getDocument().createElement("span");u.textContent=t.value.substring(e,e+1),i.appendChild(u);const c=t.getBoundingClientRect();i.style.position="fixed",i.style.left=c.left+"px",i.style.top=c.top+"px",i.style.width=c.width+"px",i.style.height=c.height+"px",i.scrollTop=t.scrollTop;const a=l.getBoundingClientRect(),h=i.getBoundingClientRect();this.getDocument().body.removeChild(i);const d=function(t,e,n){return Math.max(e,Math.min(t,n))},m={height:Math.min(h.height,a.height),left:d(a.left,h.left,h.left+h.width),top:d(a.top,h.top,h.top+h.height)};return this.getFixedCoordinatesRelativeToRect(m)}getContentEditableCaretPosition(t){const{sel:e,range:n,direction:i}=this.getContentEditableSelectionStart(!1),r=e.getRangeAt(0);this.restoreSelection(e,n,i);let o=r.getBoundingClientRect();if(e.anchorNode.parentNode){const t=e.anchorNode.parentNode.getBoundingClientRect(),n=function(t,e,n){return Math.max(e,Math.min(t,n))};o={height:Math.min(t.height,o.height),left:n(o.left,t.left,t.left+t.width),top:n(o.top,t.top,t.top+t.height)}}return this.getFixedCoordinatesRelativeToRect(o)}getFixedCoordinatesRelativeToRect(t){const e={position:"fixed",left:t.left,top:t.top+t.height},n=this.getMenuDimensions(),i=t.top,r=window.innerHeight-(t.top+t.height);r<n.height&&(i>=n.height||i>r?(e.top="auto",e.bottom=window.innerHeight-t.top,r<n.height&&(e.maxHeight=i)):i<n.height&&(e.maxHeight=r));const o=t.left,s=window.innerWidth-t.left;return s<n.width&&(o>=n.width||o>s?(e.left="auto",e.right=window.innerWidth-t.left,s<n.width&&(e.maxWidth=o)):o<n.width&&(e.maxWidth=s)),e}scrollIntoView(t){let e,n=this.menu;if(void 0===n)return;for(;void 0===e||0===e.height;)if(e=n.getBoundingClientRect(),0===e.height&&(n=n.childNodes[0],void 0===n||!n.getBoundingClientRect))return;const i=e.top,r=i+e.height;if(i<0)window.scrollTo(0,window.pageYOffset+e.top-20);else if(r>window.innerHeight){let t=window.pageYOffset+e.top-20;t-window.pageYOffset>100&&(t=window.pageYOffset+100);let n=window.pageYOffset-(window.innerHeight-r);n>t&&(n=t),window.scrollTo(0,n)}}restoreSelection(t,e,n=!0){if(t.removeAllRanges(),n)t.addRange(e);else{const n=e.cloneRange();n.collapse(!1),t.addRange(n),t.extend(e.startContainer,e.startOffset)}}}class r{constructor(t){this.tribute=t,this.tribute.search=this}simpleFilter(t,e){return e.filter((e=>this.test(t,e)))}test(t,e){return null!==this.match(t,e)}match(t,e,n){const i=(n=n||{}).pre||"",r=n.post||"",o=n.caseSensitive&&e||e.toLowerCase();if(n.skip)return{rendered:e,score:0};t=n.caseSensitive&&t||t.toLowerCase();const s=this.traverse(o,t,0,0,[]);return s?{rendered:this.render(e,s.cache,i,r),score:s.score}:null}traverse(t,e,n,i,r){if(this.tribute.autocompleteSeparator&&(e=e.split(this.tribute.autocompleteSeparator).splice(-1)[0]),e.length===i)return{score:this.calculateScore(r),cache:r.slice()};if(t.length===n||e.length-i>t.length-n)return;const o=e[i];let s,l,u=t.indexOf(o,n);for(;u>-1;){if(r.push(u),l=this.traverse(t,e,u+1,i+1,r),r.pop(),!l)return s;(!s||s.score<l.score)&&(s=l),u=t.indexOf(o,u+1)}return s}calculateScore(t){let e=0,n=1;return t.forEach(((i,r)=>{r>0&&(t[r-1]+1===i?n+=n+1:n=1),e+=n})),e}render(t,e,n,i){let r=t.substring(0,e[0]);return e.forEach(((o,s)=>{r+=n+t[o]+i+t.substring(o+1,e[s+1]?e[s+1]:t.length)})),r}filter(t,e,n){return n=n||{},e.reduce(((e,i,r,o)=>{let s=i;n.extract&&(s=n.extract(i),s||(s=""));const l=this.match(t,s,n);return null!==l&&(e[e.length]={string:l.rendered,score:l.score,index:r,original:i}),e}),[]).sort(((t,e)=>{const n=e.score-t.score;return n||t.index-e.index}))}}class o{constructor({values:t=null,loadingItemTemplate:s=null,iframe:l=null,selectClass:u="highlight",containerClass:c="tribute-container",itemClass:a="",trigger:h="@",autocompleteMode:d=!1,autocompleteSeparator:m=null,selectTemplate:p=null,menuItemTemplate:g=null,lookup:f="key",fillAttr:b="value",collection:v=null,menuContainer:w=null,noMatchTemplate:T=null,requireLeadingSpace:x=!0,allowSpaces:C=!1,replaceTextSuffix:y=null,positionMenu:S=!0,spaceSelectsMatch:E=!1,searchOpts:M={},menuItemLimit:A=null,menuShowMinLength:I=0,keys:L=null,numberOfWordsInContextText:k=5}){if(this.autocompleteMode=d,this.autocompleteSeparator=m,this.menuSelected=0,this.current={},this.isActive=!1,this.activationPending=!1,this.menuContainer=w,this.allowSpaces=C,this.replaceTextSuffix=y,this.positionMenu=S,this.hasTrailingSpace=!1,this.spaceSelectsMatch=E,this.numberOfWordsInContextText=k,L&&(e.keys=L),this.autocompleteMode&&(h="",C=!1),t)this.collection=[{trigger:h,iframe:l,selectClass:u,containerClass:c,itemClass:a,selectTemplate:(p||o.defaultSelectTemplate).bind(this),menuItemTemplate:(g||o.defaultMenuItemTemplate).bind(this),noMatchTemplate:(t=>"string"==typeof t?""===t.trim()?null:t:"function"==typeof t?t.bind(this):T||function(){return"<li>No Match Found!</li>"})(T),lookup:f,fillAttr:b,values:t,loadingItemTemplate:s,requireLeadingSpace:x,searchOpts:M,menuItemLimit:A,menuShowMinLength:I}];else{if(!v)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=v.map((t=>({trigger:t.trigger||h,iframe:t.iframe||l,selectClass:t.selectClass||u,containerClass:t.containerClass||c,itemClass:t.itemClass||a,selectTemplate:(t.selectTemplate||o.defaultSelectTemplate).bind(this),menuItemTemplate:(t.menuItemTemplate||o.defaultMenuItemTemplate).bind(this),noMatchTemplate:(t=>"string"==typeof t?""===t.trim()?null:t:"function"==typeof t?t.bind(this):T||function(){return"<li>No Match Found!</li>"})(T),lookup:t.lookup||f,fillAttr:t.fillAttr||b,values:t.values,loadingItemTemplate:t.loadingItemTemplate,requireLeadingSpace:t.requireLeadingSpace,searchOpts:t.searchOpts||M,menuItemLimit:t.menuItemLimit||A,menuShowMinLength:t.menuShowMinLength||I})))}new i(this),new e(this),new n(this),new r(this)}get isActive(){return this._isActive}set isActive(t){if(this._isActive!==t&&(this._isActive=t,this.current.element)){const e=new CustomEvent(`tribute-active-${t}`);this.current.element.dispatchEvent(e)}}static defaultSelectTemplate(t){return void 0===t?`${this.current.collection.trigger}${this.current.mentionText}`:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+t.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+t.original[this.current.collection.fillAttr]}static defaultMenuItemTemplate(t){return t.string}static inputTypes(){return["TEXTAREA","INPUT"]}triggers(){return this.collection.map((t=>t.trigger))}attach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){const e=t.length;for(let n=0;n<e;++n)this._attach(t[n])}else this._attach(t)}_attach(t){t.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+t.nodeName),this.ensureEditable(t),this.events.bind(t),t.setAttribute("data-tribute",!0)}ensureEditable(t){if(-1===o.inputTypes().indexOf(t.nodeName)){if(!t.contentEditable)throw new Error("[Tribute] Cannot bind to "+t.nodeName);t.contentEditable=!0}}createMenu(t,e){const n=window.getComputedStyle?getComputedStyle(e):e.currentStyle,i=this.range.getDocument().createElement("div"),r=this.range.getDocument().createElement("ul");return i.className=t,i.setAttribute("tabindex","0"),i.appendChild(r),i.style.fontSize=Math.round(.9*parseInt(n.fontSize))+"px",i.style.display="none",["fontStyle","fontVariant","fontWeight","fontStretch","fontSizeAdjust","fontFamily"].forEach((t=>{i.style[t]=n[t]})),this.menuContainer?this.menuContainer.appendChild(i):this.range.getDocument().body.appendChild(i)}showMenuFor(t,e){if(this.isActive&&this.current.element===t&&this.current.mentionText===this.currentMentionTextSnapshot)return;this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass,t),t.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.activationPending=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");const n=(t,n)=>{if(!this.activationPending)return;if(this.activationPending=!1,this.range.getDocument().activeElement!==this.current.element)return;if(n)return this.current.mentionPosition-=n.length,this.current.mentionText=" ".repeat(n.length)+this.current.mentionText,void this.replaceText(n.text,null,null);let i=this.search.filter(this.current.mentionText,t,{pre:this.current.collection.searchOpts.pre||"<span>",post:this.current.collection.searchOpts.post||"</span>",skip:this.current.collection.searchOpts.skip,extract:t=>{if("string"==typeof this.current.collection.lookup)return t[this.current.collection.lookup];if("function"==typeof this.current.collection.lookup)return this.current.collection.lookup(t,this.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});this.current.collection.menuItemLimit&&(i=i.slice(0,this.current.collection.menuItemLimit)),this.current.filteredItems=i;const r=this.menu.querySelector("ul");let o=!1;if(i.length){r.innerHTML="";const t=this.range.getDocument().createDocumentFragment();i.forEach(((e,n)=>{const i=this.range.getDocument().createElement("li");i.setAttribute("data-index",n),i.className=this.current.collection.itemClass,i.addEventListener("mousemove",(t=>{const[,e]=this._findLiTarget(t.target);0!==t.movementY&&this.events.setActiveLi(e)})),this.menuSelected===n&&i.classList.add(this.current.collection.selectClass),i.innerHTML=this.current.collection.menuItemTemplate(e),t.appendChild(i)})),r.appendChild(t),o=!0}else{const t=new CustomEvent("tribute-no-match",{detail:this.menu});this.current.element.dispatchEvent(t),"function"==typeof this.current.collection.noMatchTemplate&&!this.current.collection.noMatchTemplate()||!this.current.collection.noMatchTemplate?o=!1:("function"==typeof this.current.collection.noMatchTemplate?r.innerHTML=this.current.collection.noMatchTemplate():r.innerHTML=this.current.collection.noMatchTemplate,o=!0)}o&&(this.isActive=!0,this.range.positionMenuAtCaret(e))};"function"==typeof this.current.collection.values?(this.current.collection.loadingItemTemplate&&(this.menu.querySelector("ul").innerHTML=this.current.collection.loadingItemTemplate,this.range.positionMenuAtCaret(e)),this.current.collection.values(this.current.mentionText,n,this.current.fullText)):n(this.current.collection.values)}_findLiTarget(t){if(!t)return[];const e=t.getAttribute("data-index");return e?[t,e]:this._findLiTarget(t.parentNode)}showMenuForCollection(t,e){this.events.updateSelection(t)&&(t!==this.range.getDocument().activeElement&&(this.placeCaretAtEnd(t),t.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(t,this.current.collection.trigger)),this.current.collection=this.collection[e||0],this.current.element=t,this.showMenuFor(t))}placeCaretAtEnd(t){if(t.focus(),void 0!==window.getSelection&&void 0!==this.range.getDocument().createRange){const e=this.range.getDocument().createRange();e.selectNodeContents(t),e.collapse(!1);const n=window.getSelection();n.removeAllRanges(),n.addRange(e)}else if(void 0!==this.range.getDocument().body.createTextRange){const e=this.range.getDocument().body.createTextRange();e.moveToElementText(t),e.collapse(!1),e.select()}}insertTextAtCursor(t){const e=window.getSelection(),n=e.getRangeAt(0);n.deleteContents();const i=this.range.getDocument().createTextNode(t);n.insertNode(i),n.selectNodeContents(i),n.collapse(!1),e.removeAllRanges(),e.addRange(n)}insertAtCaret(t,e){const n=t.scrollTop;let i=t.selectionStart;const r=t.value.substring(0,i),o=t.value.substring(t.selectionEnd,t.value.length);t.value=r+e+o,i+=e.length,t.selectionStart=i,t.selectionEnd=i,t.focus(),t.scrollTop=n}hideMenu(){this.menu&&(this.menu.remove(),this.menu=null),this.isActive=!1,this.activationPending=!1,this.current={}}selectItemAtIndex(t,e){if("number"==typeof(t=parseInt(t))&&!isNaN(t)&&e.target){const n=this.current.filteredItems[t],i=this.current.collection.selectTemplate(n);null!==i&&this.replaceText(i,e,n)}this.hideMenu()}replaceText(t,e,n){this.range.replaceTriggerText(t,e,n)}_append(t,e,n){if("function"==typeof t.values)throw new Error("Unable to append to values, as it is a function.");t.values=n?e:t.values.concat(e)}append(t,e,n){const i=parseInt(t);if("number"!=typeof i)throw new Error("please provide an index for the collection to update.");const r=this.collection[i];this._append(r,e,n)}appendCurrent(t,e){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,t,e)}detach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){const e=t.length;for(let n=0;n<e;++n)this._detach(t[n])}else this._detach(t)}_detach(t){this.events.unbind(t),t.tributeMenu&&this.menuEvents.unbind(t.tributeMenu),setTimeout((()=>{t.removeAttribute("data-tribute"),this.isActive=!1,t.tributeMenu&&t.tributeMenu.remove()}))}debounce(t,e){let n;return(...i)=>{clearTimeout(n),n=setTimeout((()=>{t.apply(this,i)}),e)}}}return o}));
//# sourceMappingURL=tribute.min.js.map
