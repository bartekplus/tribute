!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Tribute=e()}(this,(function(){"use strict";class t{constructor(t){this.tribute=t,this.tribute.events=this}static keys(){return["Tab","Enter","Escape","ArrowUp","ArrowDown","Backspace"]}static digits(){return["Digit1","Digit2","Digit3","Digit4","Digit5","Digit6","Digit7","Digit8","Digit9","Digit0"]}static modifiers(){return["CapsLock","Control","Fn","Hyper","Meta","OS","Super","Symbol","Win"]}bind(t){t.boundKeyDown=this.tribute.debounce(this.keydown.bind(t,this),32),t.boundKeyUpInput=this.tribute.debounce(this.input.bind(t,this),32),t.addEventListener("keydown",t.boundKeyDown,!0),t.addEventListener("input",t.boundKeyUpInput,!0)}unbind(t){t.removeEventListener("keydown",t.boundKeyDown,!0),t.removeEventListener("input",t.boundKeyUpInput,!0),delete t.boundKeyDown,delete t.boundKeyUpInput}keydown(e,i){let n=!1,r=!1;i instanceof KeyboardEvent&&t.modifiers().forEach((t=>{i.getModifierState(t)&&(n=!0)})),n||(t.keys().forEach((t=>{if(t===i.code&&(e.tribute.isActive||"Backspace"==i.code))return e.callbacks()[t](i,this),void(r=!0)})),e.tribute.selectByDigit&&t.digits().forEach(((t,n)=>{if(t===i.code&&e.tribute.isActive){if(n<e.tribute.current.filteredItems.length)return e.callbacks().Digit(i,n,this),void(r=!0)}}))),r||(e.tribute.lastReplacement=null,e.tribute.hideMenu())}input(t,e){const i=e instanceof CustomEvent,n=e instanceof InputEvent,r=n&&("insertText"==e.inputType||"insertCompositionText"==e.inputType||e.inputType.startsWith("deleteContent"));i||n&&!r||t.keyup.call(this,t,e)}click(t,e){const i=t.tribute;if(i.menu&&i.menu.contains(e.target)){let t=e.target;for(e.preventDefault(),e.stopImmediatePropagation();"li"!==t.nodeName.toLowerCase();)if(t=t.parentNode,!t||t===i.menu)throw new Error("cannot find the <li> container for the click");i.selectItemAtIndex(t.getAttribute("data-index"),e)}else i.hideMenu()}keyup(e,i){if(i instanceof KeyboardEvent){if(i.key&&i.key.length>1)return;let e=!1;if(t.modifiers().forEach((t=>{i.getModifierState(t)&&(e=!0)})),t.keys().forEach((t=>{t!==i.code||(e=!0)})),e)return}if(!e.updateSelection(this))return;const n=e.getKeyCode(i);if(!isNaN(n)){if(e.tribute.autocompleteMode)e.tribute.current.collection=e.tribute.collection[0];else{const t=e.tribute.triggers().find((t=>t.charCodeAt(0)===n));if(!t)return;const i=e.tribute.collection.find((e=>e.trigger===t));if(!i)return;if(i.menuShowMinLength>e.tribute.current.mentionText.length)return;e.tribute.current.collection=i}e.tribute.showMenuFor(this,!0)}}getKeyCode(t){const e=t.keyCode||t.which||t.code;return e||(t instanceof InputEvent&&t.data?t.data.charCodeAt(t.data.length-1):this.tribute.current.mentionTriggerChar?this.tribute.current.mentionTriggerChar.charCodeAt(0):this.tribute.current.mentionText?this.tribute.current.mentionText.charCodeAt(this.tribute.current.mentionText.length-1):NaN)}updateSelection(t){this.tribute.current.element=t;const e=this.tribute.range.getTriggerInfo(this.tribute.allowSpaces,this.tribute.autocompleteMode);return!!e&&(this.tribute.current.mentionTriggerChar=e.mentionTriggerChar,this.tribute.current.mentionText=e.mentionText,this.tribute.current.mentionPosition=e.mentionPosition,this.tribute.current.fullText=e.fullText,this.tribute.current.nextChar=e.nextChar,!0)}callbacks(){return{Backspace:(t,e)=>{if(this.tribute.lastReplacement){if(this.tribute.events.updateSelection(e)&&this.tribute.current.mentionPosition==this.tribute.lastReplacement.mentionPosition+this.tribute.lastReplacement.content.length){t.preventDefault(),t.stopImmediatePropagation();const e=this.tribute.lastReplacement.content!==this.tribute.lastReplacement.content.trimEnd();this.tribute.current={...this.tribute.lastReplacement},this.tribute.current.mentionText=this.tribute.lastReplacement.content,this.tribute.replaceText(this.tribute.lastReplacement.mentionText+(e?" ":""),t,null)}this.tribute.lastReplacement=null,this.tribute.current={}}this.tribute.hideMenu()},Digit:(t,e,i)=>{this.setActiveLi(e),this.callbacks().Enter(t,i)},Enter:(t,e)=>{this.tribute.isActive&&this.tribute.current.filteredItems&&(t.preventDefault(),t.stopImmediatePropagation(),this.tribute.selectItemAtIndex(this.tribute.menuSelected,t))},Escape:(t,e)=>{this.tribute.isActive&&(t.preventDefault(),t.stopImmediatePropagation(),this.tribute.hideMenu())},Tab:(t,e)=>{this.callbacks().Enter(t,e)},Space:(t,e)=>{this.tribute.isActive&&(this.tribute.spaceSelectsMatch?this.callbacks().Enter(t,e):this.tribute.hideMenu())},ArrowUp:(t,e)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopImmediatePropagation();const e=this.tribute.current.filteredItems.length,i=this.tribute.menuSelected;e>i&&i>0?this.setActiveLi(i-1):0===i&&(this.setActiveLi(e-1),this.tribute.menu.scrollTop=this.tribute.menu.scrollHeight)}},ArrowDown:(t,e)=>{if(this.tribute.isActive&&this.tribute.current.filteredItems){t.preventDefault(),t.stopImmediatePropagation();const e=this.tribute.current.filteredItems.length-1,i=this.tribute.menuSelected;e>i?this.setActiveLi(i+1):e===i&&(this.setActiveLi(0),this.tribute.menu.scrollTop=0)}}}}setActiveLi(t){const e=this.tribute.menu.querySelectorAll("li"),i=e.length>>>0;this.tribute.menuSelected=t;for(let t=0;t<i;t++){const i=e[t];if(t===this.tribute.menuSelected){i.classList.add(this.tribute.current.collection.selectClass);const t=i.getBoundingClientRect(),e=this.tribute.menu.getBoundingClientRect();if(t.bottom>e.bottom){const i=t.bottom-e.bottom;this.tribute.menu.scrollTop+=i}else if(t.top<e.top){const i=e.top-t.top;this.tribute.menu.scrollTop-=i}}else i.classList.remove(this.tribute.current.collection.selectClass)}}}class e{constructor(t){this.tribute=t,this.tribute.menuEvents=this,this.menu=this.tribute.menu}bind(t){this.menuClickEvent=this.tribute.events.click.bind(null,this),this.menuContainerScrollEvent=this.tribute.debounce((()=>{this.tribute.hideMenu()}),100),this.windowResizeEvent=this.tribute.debounce((()=>{this.tribute.hideMenu()}),100),this.windowBlurEvent=()=>{this.tribute.hideMenu()},this.tribute.range.getDocument().addEventListener("mousedown",this.menuClickEvent,!1),window.addEventListener("resize",this.windowResizeEvent),window.addEventListener("blur",this.windowBlurEvent),this.menuContainer?this.menuContainer.addEventListener("scroll",this.menuContainerScrollEvent,!1):window.addEventListener("scroll",this.menuContainerScrollEvent)}unbind(t){this.tribute.range.getDocument().removeEventListener("mousedown",this.menuClickEvent,!1),window.removeEventListener("resize",this.windowResizeEvent),window.removeEventListener("blur",this.windowBlurEvent),this.menuContainer?this.menuContainer.removeEventListener("scroll",this.menuContainerScrollEvent,!1):window.removeEventListener("scroll",this.menuContainerScrollEvent)}}class i{constructor(t){this.tribute=t,this.tribute.range=this}getDocument(){let t;return this.tribute.current.collection&&(t=this.tribute.current.collection.iframe),t?t.contentWindow.document:document}positionMenuAtCaret(t){const e=this.tribute.current;let i;this.tribute.positionMenu?(i=this.isContentEditable(e.element)?this.getContentEditableCaretPosition(e.mentionPosition+e.mentionText.length):this.getTextAreaOrInputUnderlinePosition(e.element,e.mentionPosition+e.mentionText.length),this.tribute.menu.style.top=`${i.top}px`,this.tribute.menu.style.left=`${i.left}px`,this.tribute.menu.style.right=`${i.right}px`,this.tribute.menu.style.bottom=`${i.bottom}px`,this.tribute.menu.style["max-heigh"]=`${i.maxHeight||500}px`,this.tribute.menu.style["max-width"]=`${i.maxWidth||300}px`,this.tribute.menu.style.position=`${i.position||"absolute"}`,this.tribute.menu.style.display="block","auto"===i.left&&(this.tribute.menu.style.left="auto"),"auto"===i.top&&(this.tribute.menu.style.top="auto"),t&&this.scrollIntoView()):this.tribute.menu.style.display="block"}replaceTriggerText(t,e,i){const n=this.tribute.current,r={item:i,context:n,event:e,text:t},o=new CustomEvent("tribute-replaced");if(this.isContentEditable(n.element)){t+="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ",this.pasteContentEditable(t,n.mentionText.length+n.mentionTriggerChar.length)}else{const e=this.tribute.current.element,i="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" ";t=this.stripHtml(t),t+=i;const r=n.mentionPosition;let o=n.mentionPosition+n.mentionText.length+i.length;this.tribute.autocompleteMode||(o+=n.mentionTriggerChar.length-1),e.value=e.value.substring(0,r)+t+e.value.substring(o,e.value.length),e.selectionStart=r+t.length,e.selectionEnd=r+t.length}n.element.dispatchEvent(new CustomEvent("input",{bubbles:!0,detail:r})),n.element.dispatchEvent(o)}pasteContentEditable(t,e){const{sel:i,range:n}=this.getContentEditableSelectionStart(!0);if(i){const r=this.stripHtml(t);!(t!==r)&&i.anchorOffset>=e&&i.anchorOffset<=i.anchorNode.nodeValue.length?this.pasteText(i,n,r,e):this.pasteHtml(i,n,t,e)}}pasteText(t,e,i,n){const r=t.anchorNode.nodeValue.substring(0,t.anchorOffset-n),o=t.anchorNode.nodeValue.substring(t.anchorOffset,t.anchorNode.nodeValue.length);t.anchorNode.nodeValue=r+i+o,e.setStart(t.anchorNode,r.length+i.length),e.collapse(!0),t.removeAllRanges(),t.addRange(e),t.collapseToEnd()}pasteHtml(t,e,i,n){for(let e=0;e<n;e++)t.modify("extend","backward","character");const r=t.getRangeAt(0);r.deleteContents();const o=this.getDocument().createElement("div");o.innerHTML=i;const s=this.getDocument().createDocumentFragment();let l,c;for(;l=o.firstChild;)c=s.appendChild(l);r.insertNode(s),c&&(r.setStart(c,c.length),r.setEnd(c,c.length),r.collapse(!0),t.removeAllRanges(),t.addRange(r),t.collapseToEnd())}stripHtml(t){const e=this.getDocument().createElement("DIV");return e.innerHTML=t,e.textContent||e.innerText||""}getWindowSelection(){if(this.tribute.collection.iframe)return this.tribute.collection.iframe.contentWindow.getSelection();const t=this.tribute.current.element.getRootNode();return t.getSelection?t.getSelection():window.getSelection()}getContentEditableSelectionStart(t){const e=this.getWindowSelection();if(!e.isCollapsed)return{sel:null,range:null,direction:null};const i=e.anchorOffset<=e.focusOffset,n=e.getRangeAt(0),r=e.anchorNode,o=r.textContent,s=n.startOffset;let l=o.length>s?o[s]:null;if(null===l&&r.nextSibling&&r.nextSibling.textContent){const t=r.nextSibling.textContent;l=t.length?t[0]:null}const c=!this.tribute.autocompleteSeparator||l&&l.match(this.tribute.autocompleteSeparator);return e.collapseToEnd(),l&&!c&&t&&e.modify("move","forward","word"),{sel:e,range:n,direction:i}}getWholeWordsUpToCharIndex(t,e){if(this.tribute.autocompleteSeparator){let i=0;const n=t.split(this.tribute.autocompleteSeparator).filter((function(t){return t.trim()}));for(let r=0,o=n.length;r<o;r++){const o=t.indexOf(n[r],i);if(i+=n[r].length,e>=o&&e<=o+n[r].length){e=o+n[r].length;break}}}const i=t.length>e?t[e]:"";return[t.substring(0,e),i]}getTextForCurrentSelection(){const t=this.tribute.current;let e=null,i="";if(this.isContentEditable(t.element)){const{sel:t,range:n,direction:r}=this.getContentEditableSelectionStart(!0);if(t){const o=t.anchorNode.textContent,s=t.getRangeAt(0).startOffset,l=o[Math.max(0,s-1)];let c=l&&l!==l.trim();e=t.toString().trim(),i=o.length>s?o[s]:"";for(let i=0;i<this.tribute.numberOfWordsInContextText;i++){t.modify("extend","backward","word");const i=t.toString();i.length>e.length&&i.endsWith(e)&&(e=i)}c=c&&e===e.trimEnd(),e+=c?" ":"",this.restoreSelection(t,n,r)}}else{const t=this.tribute.current.element;if(t){const n=t.selectionStart,r=t.selectionEnd;if(t.value&&n>=0&&n===r){const r=this.getWholeWordsUpToCharIndex(t.value,n);e=r[0],i=r[1]}}}return{effectiveRange:e,nextChar:i}}getLastWordInText(t){if(this.tribute.autocompleteSeparator){const e=t.split(this.tribute.autocompleteSeparator);return e.length?e[e.length-1]:" "}return t}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getTriggerInfo(t,e){let i=!0;const{effectiveRange:n,nextChar:r}=this.getTextForCurrentSelection();if(null===n)return null;const o=this.getLastWordInText(n);if(e)return{mentionPosition:n.length-o.length,mentionText:o,fullText:n,nextChar:r,mentionTriggerChar:""};if(null!=n){let e,r=-1;if(this.tribute.collection.forEach((t=>{const o=t.trigger,s="("+(t.requireLeadingSpace?"\\s":"")+this.escapeRegExp(o)+")(?!.*\\1)",l=n.match(RegExp(s)),c=l?l.index+(t.requireLeadingSpace?1:0):n.startsWith(o)?0:-1;c>r&&(r=c,e=o,i=t.requireLeadingSpace)})),r>=0&&(0===r||!i||/\s/.test(n.substring(r-1,r)))){const i=n.substring(r+e.length,n.length);e=n.substring(r,r+e.length);const o=i.substring(0,1),s=i.length>0&&(" "===o||" "===o),l=i!==i.trimEnd();if(!s&&(t||!l))return{mentionPosition:r,mentionText:i,mentionTriggerChar:e,fullText:n,nextChar:""}}}}isContentEditable(t){return"INPUT"!==t.nodeName&&"TEXTAREA"!==t.nodeName}isMenuOffScreen(t,e){const i=window.innerWidth,n=window.innerHeight,r=this.getDocument().documentElement,o=(window.pageXOffset||r.scrollLeft)-(r.clientLeft||0),s=(window.pageYOffset||r.scrollTop)-(r.clientTop||0),l="number"==typeof t.top?t.top:t.bottom-e.height,c="number"==typeof t.right?t.right:t.left+e.width,u="number"==typeof t.bottom?t.bottom:t.top+e.height,a="number"==typeof t.left?t.left:t.right-e.width;return{top:l<Math.floor(s),right:c>Math.ceil(o+i),bottom:u>Math.ceil(s+n),left:a<Math.floor(o)}}getMenuDimensions(){const t={width:null,height:null};return this.tribute.menu.style.top="0px",this.tribute.menu.style.left="0px",this.tribute.menu.style.right=null,this.tribute.menu.style.bottom=null,this.tribute.menu.style.position="fixed",this.tribute.menu.style.visibility="hidden",this.tribute.menu.style.display="block",t.width=this.tribute.menu.offsetWidth,t.height=this.tribute.menu.offsetHeight,this.tribute.menu.style.display="none",this.tribute.menu.style.visibility="visible",t}getTextAreaOrInputUnderlinePosition(t,e,i){const n=this.getDocument().createElement("div");n.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(n);const r=n.style,o=window.getComputedStyle?getComputedStyle(t):t.currentStyle;r.whiteSpace="pre-wrap","INPUT"!==t.nodeName&&(r.wordWrap="break-word"),r.position="absolute",r.visibility="hidden",["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","borderStyle","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"].forEach((t=>{r[t]=o[t]}));const s=this.getDocument().createElement("span");s.textContent=t.value.substring(0,e),n.appendChild(s),"INPUT"===t.nodeName&&(n.textContent=n.textContent.replace(/\s/g," "));const l=this.getDocument().createElement("span");n.appendChild(l);const c=this.getDocument().createElement("span");c.textContent=t.value.substring(e,e+1),n.appendChild(c);const u=t.getBoundingClientRect();n.style.position="fixed",n.style.left=u.left+"px",n.style.top=u.top+"px",n.style.width=u.width+"px",n.style.height=u.height+"px",n.scrollTop=t.scrollTop;const a=l.getBoundingClientRect(),h=n.getBoundingClientRect();this.getDocument().body.removeChild(n);const d=function(t,e,i){return Math.max(e,Math.min(t,i))},m={height:Math.min(h.height,a.height),left:d(a.left,h.left,h.left+h.width),top:d(a.top,h.top,h.top+h.height)};return this.getFixedCoordinatesRelativeToRect(m)}getContentEditableCaretPosition(t){const{sel:e,range:i,direction:n}=this.getContentEditableSelectionStart(!1),r=e.getRangeAt(0);this.restoreSelection(e,i,n);let o=r.getBoundingClientRect();if(e.anchorNode.parentNode){const t=e.anchorNode.parentNode.getBoundingClientRect(),i=function(t,e,i){return Math.max(e,Math.min(t,i))};o={height:Math.min(t.height,o.height),left:i(o.left,t.left,t.left+t.width),top:i(o.top,t.top,t.top+t.height)}}return this.getFixedCoordinatesRelativeToRect(o)}getFixedCoordinatesRelativeToRect(t){const e={position:"fixed",left:t.left,top:t.top+t.height},i=this.getMenuDimensions(),n=t.top,r=window.innerHeight-(t.top+t.height);r<i.height&&(n>=i.height||n>r?(e.top="auto",e.bottom=window.innerHeight-t.top,r<i.height&&(e.maxHeight=n)):n<i.height&&(e.maxHeight=r));const o=t.left,s=window.innerWidth-t.left;return s<i.width&&(o>=i.width||o>s?(e.left="auto",e.right=window.innerWidth-t.left,s<i.width&&(e.maxWidth=o)):o<i.width&&(e.maxWidth=s)),e}scrollIntoView(t){let e,i=this.menu;if(void 0===i)return;for(;void 0===e||0===e.height;)if(e=i.getBoundingClientRect(),0===e.height&&(i=i.childNodes[0],void 0===i||!i.getBoundingClientRect))return;const n=e.top,r=n+e.height;if(n<0)window.scrollTo(0,window.pageYOffset+e.top-20);else if(r>window.innerHeight){let t=window.pageYOffset+e.top-20;t-window.pageYOffset>100&&(t=window.pageYOffset+100);let i=window.pageYOffset-(window.innerHeight-r);i>t&&(i=t),window.scrollTo(0,i)}}restoreSelection(t,e,i=!0){if(t.removeAllRanges(),i)t.addRange(e);else{const i=e.cloneRange();i.collapse(!1),t.addRange(i),t.extend(e.startContainer,e.startOffset)}}}class n{constructor(t){this.tribute=t,this.tribute.search=this}match(t,e,i){const n=(i=i||{}).pre||"",r=i.post||"",o=i.caseSensitive&&e||e.toLowerCase();if(i.skip)return{rendered:e,score:0};t=i.caseSensitive&&t||t.toLowerCase();const s=this.traverse(o,t,0,0,[]);return s?{rendered:this.render(e,s.cache,n,r),score:s.score}:null}traverse(t,e,i,n,r){if(this.tribute.autocompleteMode&&this.tribute.autocompleteSeparator&&(e=e.split(this.tribute.autocompleteSeparator).splice(-1)[0]),e.length===n)return{score:this.calculateScore(r),cache:r.slice()};if(t.length===i||e.length-n>t.length-i)return;const o=e[n];let s,l,c=t.indexOf(o,i);for(;c>-1;){if(r.push(c),l=this.traverse(t,e,c+1,n+1,r),r.pop(),!l)return s;(!s||s.score<l.score)&&(s=l),c=t.indexOf(o,c+1)}return s}calculateScore(t){let e=0,i=1;return t.forEach(((n,r)=>{r>0&&(t[r-1]+1===n?i+=i+1:i=1),e+=i})),e}render(t,e,i,n){let r=t.substring(0,e[0]);return e.forEach(((o,s)=>{r+=i+t[o]+n+t.substring(o+1,e[s+1]?e[s+1]:t.length)})),r}filter(t,e,i){return i=i||{},e.reduce(((e,n,r,o)=>{let s=n;i.extract&&(s=i.extract(n),s||(s=""));const l=this.match(t,s,i);return null!==l&&(e[e.length]={string:l.rendered,score:l.score,index:r,original:n}),e}),[]).sort(((t,e)=>{const i=e.score-t.score;return i||t.index-e.index}))}}class r{constructor({values:o=null,loadingItemTemplate:s=null,iframe:l=null,selectClass:c="highlight",containerClass:u="tribute-container",itemClass:a="",trigger:h="@",autocompleteMode:d=!1,autocompleteSeparator:m=RegExp(/\s+/),selectTemplate:p=null,menuItemTemplate:g=null,lookup:f="key",fillAttr:b="value",collection:v=null,menuContainer:T=null,noMatchTemplate:w=null,requireLeadingSpace:x=!0,allowSpaces:C=!1,replaceTextSuffix:y=null,positionMenu:S=!0,spaceSelectsMatch:E=!1,searchOpts:M={},menuItemLimit:A,menuShowMinLength:I=0,keys:L=null,numberOfWordsInContextText:R=5,supportRevert:D=!1,selectByDigit:k=!1}){if(this.autocompleteMode=d,this.autocompleteSeparator=m,this.menuSelected=0,this.current={},this.lastReplacement=null,this.isActive=!1,this.activationPending=!1,this.menuContainer=T,this.allowSpaces=C,this.replaceTextSuffix=y,this.positionMenu=S,this.spaceSelectsMatch=E,this.numberOfWordsInContextText=R,this.supportRevert=D,this.selectByDigit=k,L&&(t.keys=L),this.autocompleteMode&&(h="",C=!1),o)this.collection=[{trigger:h,iframe:l,selectClass:c,containerClass:u,itemClass:a,selectTemplate:(p||r.defaultSelectTemplate).bind(this),menuItemTemplate:(g||r.defaultMenuItemTemplate).bind(this),noMatchTemplate:(t=>"string"==typeof t?""===t.trim()?null:t:"function"==typeof t?t.bind(this):w||function(){return"<li>No Match Found!</li>"})(w),lookup:f,fillAttr:b,values:o,loadingItemTemplate:s,requireLeadingSpace:x,searchOpts:M,menuItemLimit:A,menuShowMinLength:I}];else{if(!v)throw new Error("[Tribute] No collection specified.");this.autocompleteMode&&console.warn("Tribute in autocomplete mode does not work for collections"),this.collection=v.map((t=>({trigger:t.trigger||h,iframe:t.iframe||l,selectClass:t.selectClass||c,containerClass:t.containerClass||u,itemClass:t.itemClass||a,selectTemplate:(t.selectTemplate||r.defaultSelectTemplate).bind(this),menuItemTemplate:(t.menuItemTemplate||r.defaultMenuItemTemplate).bind(this),noMatchTemplate:(t=>"string"==typeof t?""===t.trim()?null:t:"function"==typeof t?t.bind(this):w||function(){return"<li>No Match Found!</li>"})(w),lookup:t.lookup||f,fillAttr:t.fillAttr||b,values:t.values,loadingItemTemplate:t.loadingItemTemplate,requireLeadingSpace:t.requireLeadingSpace,searchOpts:t.searchOpts||M,menuItemLimit:t.menuItemLimit||A,menuShowMinLength:t.menuShowMinLength||I})))}new i(this),new t(this),new e(this),new n(this)}get isActive(){return this._isActive}set isActive(t){if(this._isActive!==t&&(this._isActive=t,this.current.element)){const e=new CustomEvent(`tribute-active-${t}`);this.current.element.dispatchEvent(e)}}static defaultSelectTemplate(t){return void 0===t?`${this.current.collection.trigger}${this.current.mentionText}`:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+t.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+t.original[this.current.collection.fillAttr]}static defaultMenuItemTemplate(t){return t.string}static inputTypes(){return["TEXTAREA","INPUT"]}triggers(){return this.collection.map((t=>t.trigger))}attach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){const e=t.length;for(let i=0;i<e;++i)this._attach(t[i])}else this._attach(t)}_attach(t){t.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+t.nodeName),this.ensureEditable(t),this.events.bind(t),t.setAttribute("data-tribute",!0)}ensureEditable(t){if(-1===r.inputTypes().indexOf(t.nodeName)){if(!t.contentEditable)throw new Error("[Tribute] Cannot bind to "+t.nodeName);t.contentEditable=!0}}createMenu(t,e){const i=window.getComputedStyle?getComputedStyle(e):e.currentStyle,n=this.range.getDocument().createElement("div"),r=this.range.getDocument().createElement("ul");return n.className=t,n.setAttribute("tabindex","0"),n.appendChild(r),n.style.fontSize=Math.round(.9*parseInt(i.fontSize))+"px",n.style.display="none",["fontStyle","fontVariant","fontWeight","fontStretch","fontSizeAdjust","fontFamily"].forEach((t=>{n.style[t]=i[t]})),this.menuContainer?this.menuContainer.appendChild(n):this.range.getDocument().body.appendChild(n)}showMenuFor(t,e){if(this.isActive&&this.current.element===t&&this.current.mentionText===this.currentMentionTextSnapshot)return;this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(this.current.collection.containerClass,t),t.tributeMenu=this.menu,this.menuEvents.bind(this.menu)),this.activationPending=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="");const i=(t,i)=>{if(!this.activationPending)return;if(this.activationPending=!1,this.range.getDocument().activeElement!==this.current.element)return;if(i)return this.current.mentionPosition-=i.length,this.current.mentionText=this.current.fullText.slice(-i.length),void this.replaceText(i.text,null,null);let n=this.search.filter(this.current.mentionText,t,{pre:this.current.collection.searchOpts.pre||"<span>",post:this.current.collection.searchOpts.post||"</span>",skip:this.current.collection.searchOpts.skip||!1,caseSensitive:this.current.collection.searchOpts.caseSensitive||!1,extract:t=>{if("string"==typeof this.current.collection.lookup)return t[this.current.collection.lookup];if("function"==typeof this.current.collection.lookup)return this.current.collection.lookup(t,this.current.mentionText);throw new Error("Invalid lookup attribute, lookup must be string or function.")}});n=n.slice(0,this.current.collection.menuItemLimit),this.current.filteredItems=n;const r=this.menu.querySelector("ul");let o=!1;if(n.length){r.innerHTML="";const t=this.range.getDocument().createDocumentFragment();n.forEach(((e,i)=>{const n=this.range.getDocument().createElement("li");n.setAttribute("data-index",i),n.className=this.current.collection.itemClass,n.addEventListener("mouseover",function(t){this.events.setActiveLi(t)}.bind(this,i)),this.menuSelected===i&&n.classList.add(this.current.collection.selectClass),n.innerHTML=this.current.collection.menuItemTemplate(e),this.selectByDigit&&(n.innerHTML=((i+1)%10).toString()+". "+n.innerHTML),t.appendChild(n)})),r.appendChild(t),o=!0}else{const t=new CustomEvent("tribute-no-match",{detail:this.menu});this.current.element.dispatchEvent(t),"function"==typeof this.current.collection.noMatchTemplate&&!this.current.collection.noMatchTemplate()||!this.current.collection.noMatchTemplate?o=!1:("function"==typeof this.current.collection.noMatchTemplate?r.innerHTML=this.current.collection.noMatchTemplate():r.innerHTML=this.current.collection.noMatchTemplate,o=!0)}o&&(this.isActive=!0,this.range.positionMenuAtCaret(e))};"function"==typeof this.current.collection.values?(this.current.collection.loadingItemTemplate&&(this.menu.querySelector("ul").innerHTML=this.current.collection.loadingItemTemplate,this.range.positionMenuAtCaret(e)),this.current.collection.values(this.current.mentionText,i,this.current.fullText,this.current.nextChar)):i(this.current.collection.values)}showMenuForCollection(t,e){this.events.updateSelection(t)&&(t!==this.range.getDocument().activeElement&&(this.placeCaretAtEnd(t),t.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(t,this.current.collection.trigger)),this.current.collection=this.collection[e||0],this.current.element=t,this.showMenuFor(t))}placeCaretAtEnd(t){if(t.focus(),void 0!==window.getSelection&&void 0!==this.range.getDocument().createRange){const e=this.range.getDocument().createRange();e.selectNodeContents(t),e.collapse(!1);const i=window.getSelection();i.removeAllRanges(),i.addRange(e)}else if(void 0!==this.range.getDocument().body.createTextRange){const e=this.range.getDocument().body.createTextRange();e.moveToElementText(t),e.collapse(!1),e.select()}}insertTextAtCursor(t){const e=window.getSelection(),i=e.getRangeAt(0);i.deleteContents();const n=this.range.getDocument().createTextNode(t);i.insertNode(n),i.selectNodeContents(n),i.collapse(!1),e.removeAllRanges(),e.addRange(i)}insertAtCaret(t,e){const i=t.scrollTop;let n=t.selectionStart;const r=t.value.substring(0,n),o=t.value.substring(t.selectionEnd,t.value.length);t.value=r+e+o,n+=e.length,t.selectionStart=n,t.selectionEnd=n,t.focus(),t.scrollTop=i}hideMenu(){this.menu&&(this.menu.remove(),this.menu=null),this.isActive=!1,this.activationPending=!1,this.current={}}selectItemAtIndex(t,e){if("number"==typeof(t=parseInt(t))&&!isNaN(t)&&e.target){const i=this.current.filteredItems[t],n=this.current.collection.selectTemplate(i);null!==n&&this.replaceText(n,e,i)}this.hideMenu()}replaceText(t,e,i){this.supportRevert&&(this.lastReplacement={...this.current},this.lastReplacement.content=t),this.range.replaceTriggerText(t,e,i)}_append(t,e,i){if("function"==typeof t.values)throw new Error("Unable to append to values, as it is a function.");t.values=i?e:t.values.concat(e)}append(t,e,i){const n=parseInt(t);if("number"!=typeof n)throw new Error("please provide an index for the collection to update.");const r=this.collection[n];this._append(r,e,i)}appendCurrent(t,e){if(!this.isActive)throw new Error("No active state. Please use append instead and pass an index.");this._append(this.current.collection,t,e)}detach(t){if(!t)throw new Error("[Tribute] Must pass in a DOM node or NodeList.");if("undefined"!=typeof jQuery&&t instanceof jQuery&&(t=t.get()),t.constructor===NodeList||t.constructor===HTMLCollection||t.constructor===Array){const e=t.length;for(let i=0;i<e;++i)this._detach(t[i])}else this._detach(t)}_detach(t){this.events.unbind(t),t.tributeMenu&&this.menuEvents.unbind(t.tributeMenu),setTimeout((()=>{t.removeAttribute("data-tribute"),this.isActive=!1,t.tributeMenu&&t.tributeMenu.remove()}))}debounce(t,e,i={leading:!0,trailing:!0}){let n=null;return(...r)=>{const o=i.leading&&null===n,s=(e=>{n=null,e&&t.apply(this,r)}).bind(this,!o&&i.trailing);clearTimeout(n),n=setTimeout(s,e),o&&t.apply(this,r)}}}return r}));
//# sourceMappingURL=tribute.min.js.map
